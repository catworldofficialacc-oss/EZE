#!/bin/bash
# Ez Keys Installer: eze
# Usage:
# eze <ModuleName> [update|remove]

EZ_ROOT="$HOME/ez_runtime"
MODULES_DIR="$EZ_ROOT/modules"
mkdir -p "$MODULES_DIR"

MODULE="$1"
ACTION="$2"

if [[ -z "$MODULE" ]]; then
    echo "Usage: eze <ModuleName> [update|remove]"
    exit 1
fi

module_path="$MODULES_DIR/$MODULE"

# Default GitHub raw URL (currently only Keys)
GITHUB_RAW="https://raw.githubusercontent.com/catworldofficialacc-oss/EZK/main/Keys0.2.0"

case "$ACTION" in
    update)
        if [[ ! -d "$module_path" ]]; then
            echo "Module '$MODULE' is not installed. Run 'eze $MODULE' to install it first."
            exit 1
        fi
        rm -f "$module_path"/*
        mkdir -p "$module_path"
        ;;
    remove)
        if [[ ! -d "$module_path" ]]; then
            echo "Module '$MODULE' is not installed."
            exit 1
        fi
        rm -rf "$module_path"
        echo "Module '$MODULE' removed successfully ❌"
        exit 0
        ;;
    "")
        # default action is install
        if [[ -d "$module_path" ]]; then
            echo "Module '$MODULE' is already installed. Use 'eze $MODULE update' to refresh."
            exit 0
        fi
        mkdir -p "$module_path"
        ;;
    *)
        echo "Unknown action: $ACTION"
        echo "Usage: eze <ModuleName> [update|remove]"
        exit 1
        ;;
esac

# Download module (currently only Keys)
if command -v curl &>/dev/null; then
    curl -s -o "$module_path/Keys0.2.0" "$GITHUB_RAW"
elif command -v wget &>/dev/null; then
    wget -q -O "$module_path/Keys0.2.0" "$GITHUB_RAW"
else
    echo "Error: curl or wget not installed"
    exit 1
fi

echo "Module '$MODULE' installed/updated successfully ✅"
#
